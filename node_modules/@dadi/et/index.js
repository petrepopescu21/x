const client = require('dgram').createSocket('udp4')
const os = require('os')

module.exports = function ({package, productPackage, event, customData, environment}) {
  try {
    let data = {
      timestamp: Date.now(),
      environment: environment,
      product: productPackage.name,
      site: package.name,
      version: productPackage.version,
      event: event,
      system: {
        platform: os.platform(),
        release: os.release(),
        hostname: os.hostname(),
        uptime: os.uptime(),
        nodejs: process.versions.node,
        memory: {
          free: os.freemem(),
          total: os.totalmem()
        }
      }
    }

    if (customData) {
      data.custom = customData
    }

    data = new Buffer(JSON.stringify(data))

    client.send(data, 2222, 'home.dadi.tech', err => {
      client.close()
    })
  } catch (err) {
    console.log('ET ERROR:', err)
  }
}